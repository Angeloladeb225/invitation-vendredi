<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>On sort ce vendredi ? ‚ú®</title>
  <style>
    :root{
      --bg1:#0f1226;
      --bg2:#1b1f3a;
      --text:#f3f5ff;
      --muted:#b9c0ff;
      --accent:#7c5cff;
      --accent2:#27d7c4;
      --shadow: 0 18px 50px rgba(0,0,0,.45);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 800px at 20% 10%, #3a2bff33, transparent 60%),
        radial-gradient(900px 600px at 90% 30%, #27d7c422, transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
      overflow:hidden;
    }

    /* ALWAYS OPEN modal */
    .overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.58);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:50;
    }
    .modal{
      width:min(680px, 100%);
      background:linear-gradient(180deg, #0b0f24f2, #0b0f24ea);
      border:1px solid #ffffff1a;
      border-radius:22px;
      box-shadow: var(--shadow);
      padding:22px;
      position:relative;
      overflow:hidden;
    }
    .close{
      position:absolute;
      top:12px; right:12px;
      width:42px; height:42px;
      border-radius:14px;
      background:#ffffff10;
      border:1px solid #ffffff1a;
      color:#fff;
      font-size:18px;
      cursor:pointer;
    }
    .progress{display:flex; gap:6px; margin-bottom:12px}
    .dot{
      height:8px; width:28px;
      border-radius:999px;
      background:#ffffff12;
      border:1px solid #ffffff1a;
    }
    .dot.on{background: linear-gradient(135deg, var(--accent), var(--accent2)); border-color:transparent}

    h2{margin:0 0 8px; font-size: clamp(22px, 3vw, 30px); letter-spacing:-0.02em}
    p{margin:0 0 12px; color:#e9ecff; font-size:16px; line-height:1.5}
    .muted{color:var(--muted)}
    .row{display:flex; gap:12px; flex-wrap:wrap; margin-top:18px}

    button{
      border:0;
      padding:12px 16px;
      border-radius:14px;
      cursor:pointer;
      font-weight:800;
      font-size:15px;
      transition: transform .12s ease, filter .12s ease, background .12s ease;
      user-select:none;
    }
    button:active{transform: translateY(1px) scale(.99)}
    .primary{
      background:linear-gradient(135deg, var(--accent), #5bd7ff);
      color:#0b0f24;
      box-shadow: 0 10px 24px rgba(124,92,255,.25);
    }
    .ghost{
      background:#ffffff10;
      color:var(--text);
      border:1px solid #ffffff1a;
    }
    .chip{
      background:#ffffff10;
      color:var(--text);
      border:1px solid #ffffff1a;
    }
    .chip:hover{filter:brightness(1.08)}
    .primary:hover{filter:brightness(1.06); transform: translateY(-1px)}
    .ghost:hover{filter:brightness(1.08); transform: translateY(-1px)}

    .choiceBox{
      margin-top:14px;
      background:#ffffff08;
      border:1px dashed #ffffff25;
      border-radius:18px;
      padding:16px;
    }
    .grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap:10px;
    }
    @media (max-width:650px){ .grid{grid-template-columns:1fr} }

    /* Question area */
    .askArea{
      margin-top:14px;
      height:190px;
      position:relative;
      border-radius:18px;
      background: radial-gradient(700px 220px at 10% 20%, #7c5cff22, transparent 60%),
                  radial-gradient(700px 220px at 90% 80%, #27d7c41a, transparent 60%),
                  #ffffff06;
      border:1px solid #ffffff12;
      overflow:hidden;
    }
    .askBtns{position:absolute; inset:0; padding:16px}
    .yesBtn{
      position:absolute;
      left:18px; top:18px;
      background: linear-gradient(135deg, #27d7c4, #9bff6a);
      color:#07141a;
      z-index:2;
    }
    .noBtn{
      position:absolute;
      background: linear-gradient(135deg, #ff4d6d, #ffb703);
      color:#170510;
      z-index:1;
    }
    .tip{margin-top:10px; font-size:13px; color:var(--muted)}
    .note{
      margin-top:12px;
      padding:10px 12px;
      border-radius:14px;
      background:#ffffff08;
      border:1px solid #ffffff12;
      color:var(--muted);
      font-size:13px;
    }

    /* Confetti */
    .confetti{
      position:fixed;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index:60;
      display:none;
    }
    .confetti.show{display:block}
    .piece{
      position:absolute;
      width:10px; height:14px;
      opacity:.95;
      top:-20px;
      border-radius:3px;
      animation: fall linear forwards;
    }
    @keyframes fall{ to{ transform: translateY(120vh) rotate(720deg); opacity:1 } }

    /* YES storm overlay */
    .storm{
      position:fixed;
      inset:0;
      display:none;
      z-index:80;
      background:
        radial-gradient(1200px 900px at 20% 10%, #7c5cff22, transparent 60%),
        radial-gradient(900px 700px at 90% 30%, #27d7c41f, transparent 60%),
        rgba(0,0,0,.75);
      backdrop-filter: blur(6px);
      overflow:hidden;
    }
    .storm.show{display:block}
    .stormHeader{
      position:absolute;
      left:16px; right:16px; top:14px;
      background:#0b0f24cc;
      border:1px solid #ffffff1a;
      border-radius:16px;
      padding:12px 14px;
      box-shadow: var(--shadow);
    }
    .stormHeader h3{
      margin:0 0 4px;
      font-size:16px;
      letter-spacing:-.01em;
    }
    .stormHeader .small{
      margin:0;
      color:var(--muted);
      font-size:13px;
      line-height:1.35;
    }
    .yesBubble{
      position:absolute;
      background: linear-gradient(135deg, #27d7c4, #9bff6a);
      color:#07141a;
      border-radius:999px;
      padding:10px 14px;
      font-weight:900;
      box-shadow: 0 12px 28px rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.22);
      white-space:nowrap;
      cursor:pointer;
      transform: translateZ(0);
      animation: pop .12s ease-out;
    }
    @keyframes pop{ from{ transform: scale(.92); opacity:.6 } to{ transform: scale(1); opacity:1 } }
  </style>
</head>
<body>

  <div class="overlay" id="overlay" aria-hidden="false">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="mTitle">
      <button class="close" id="closeBtn" aria-label="Fermer">‚úï</button>

      <div class="progress" aria-label="Progression">
        <div class="dot on" id="dot2"></div>
        <div class="dot" id="dot3"></div>
      </div>

      <h2 id="mTitle">Petite question üòÑ</h2>
      <p><b>On sort ce vendredi ?</b></p>
      <p class="muted">Promis c‚Äôest une sortie tranquille. Et le ‚Äúnon‚Äù‚Ä¶ a un petit souci de confiance aujourd‚Äôhui üôÉ</p>

      <div class="choiceBox" id="step2">
        <div class="askArea" id="askArea">
          <div class="askBtns">
            <button class="yesBtn" id="yes">Oui üíö</button>
            <button class="noBtn" id="no">Non üôÉ</button>
          </div>
        </div>

        <div class="tip" id="tip">üí° Essaie d‚Äôattraper ‚ÄúNon‚Äù‚Ä¶ si tu peux üòÖ</div>

        <div class="row" style="margin-top:14px">
          <button class="ghost" id="notNow">Pas cette fois üôÇ</button>
        </div>
      </div>

      <div class="choiceBox" id="step3" style="display:none">
        <h2>Vendredi soir : tu choisis le programme üóìÔ∏è</h2>
        <p><span class="muted">Date :</span> <b id="dateLabel">Vendredi soir</b><br>
           <span class="muted">Lieu :</span> <b>selon ton choix</b>
        </p>
        <p>Tu pr√©f√®res quoi ?</p>

        <div class="grid">
          <button class="chip" data-plan="Bouffe üçΩÔ∏è">Bouffe üçΩÔ∏è</button>
          <button class="chip" data-plan="Cin√© üé¨">Cin√© üé¨</button>
          <button class="chip" data-plan="Cin√© + Bouffe üé¨üçΩÔ∏è">Cin√© + Bouffe üé¨üçΩÔ∏è</button>
        </div>

        <div class="note" id="planNote" style="display:none"></div>

        <div class="row" style="margin-top:14px">
          <button class="primary" id="send">Envoyer ma r√©ponse</button>
          <button class="ghost" id="back">Revenir</button>
        </div>

        <div class="note">
          üí¨ L‚Äôenvoi se fait via WhatsApp.
        </div>
      </div>
    </div>
  </div>

  <!-- YES storm -->
  <div class="storm" id="storm" aria-hidden="true">
    <div class="stormHeader">
      <h3 id="stormTitle">Regarde l√† ! tu n'as pas le choix ma s≈ìur üòÇ</h3>
      <p class="small" id="stormSubtitle">‚Ä¶</p>
    </div>
  </div>

  <div class="confetti" id="confetti"></div>

  <script>
    const $ = (s)=>document.querySelector(s);

    // Hardcoded WhatsApp number (user provided): 0153400027
    const RAW_WA = "0153400027";

    function normalizeWhatsAppNumber(raw){
      const digits = (raw || "").replace(/\D/g,"");
      // If it looks like a C√¥te d'Ivoire local number starting with 0 and 10 digits, convert to +225 (remove leading 0)
      if(digits.length === 10 && digits.startsWith("0")){
        return "225" + digits.slice(1);
      }
      // Otherwise, use digits as-is
      return digits;
    }

    const WA_NUMBER = normalizeWhatsAppNumber(RAW_WA);

    const confetti = $("#confetti");
    const step3 = $("#step3");
    const step2 = $("#step2");
    const dot3 = $("#dot3");

    function goStep3(){
      step2.style.display = "none";
      step3.style.display = "block";
      dot3.classList.add("on");
      $("#dateLabel").textContent = "Vendredi soir";
    }
    function goStep2(){
      step3.style.display = "none";
      step2.style.display = "block";
      dot3.classList.remove("on");
      $("#dateLabel").textContent = "Vendredi soir";
    }
    $("#back").addEventListener("click", goStep2);

    // --- NO button move logic (avoid overlapping YES) ---
    const askArea = $("#askArea");
    const noBtn = $("#no");
    const yesBtn = $("#yes");
    let escapes = 0;

    function rectsOverlap(a,b, pad=10){
      return !(a.right + pad < b.left || a.left - pad > b.right || a.bottom + pad < b.top || a.top - pad > b.bottom);
    }

    function moveNoBtn(){
      const area = askArea.getBoundingClientRect();
      const btn = noBtn.getBoundingClientRect();
      const yes = yesBtn.getBoundingClientRect();
      const pad = 16;

      const maxX = area.width - btn.width - pad*2;
      const maxY = area.height - btn.height - pad*2;

      let tries = 0;
      while(tries < 35){
        const x = pad + Math.random() * Math.max(0, maxX);
        const y = pad + Math.random() * Math.max(0, maxY);

        const prospective = {
          left: area.left + x,
          top: area.top + y,
          right: area.left + x + btn.width,
          bottom: area.top + y + btn.height
        };

        if(!rectsOverlap(prospective, yes, 18)){
          noBtn.style.left = x + "px";
          noBtn.style.top  = y + "px";
          return;
        }
        tries++;
      }
      noBtn.style.left = (area.width - btn.width - pad) + "px";
      noBtn.style.top  = (area.height - btn.height - pad) + "px";
    }

    function showTip(text){ $("#tip").textContent = text; }

    const proximity = 75; // px
    askArea.addEventListener("pointermove", (e)=>{
      const nb = noBtn.getBoundingClientRect();
      const dx = (nb.left + nb.width/2) - e.clientX;
      const dy = (nb.top + nb.height/2) - e.clientY;
      const dist = Math.hypot(dx, dy);

      if(dist < proximity){
        escapes++;
        moveNoBtn();
        if(escapes===1) showTip("üòÖ Oups‚Ä¶ il a boug√© tout seul.");
        if(escapes===3) showTip("Ok, on dirait qu‚Äôil fait du parkour.");
        if(escapes===6) showTip("Bon‚Ä¶ j‚Äôai l‚Äôimpression que ‚ÄúOui‚Äù est plus simple üòÑ");
      }
    });

    noBtn.addEventListener("click", ()=>{
      alert("üëÄ Tentative d√©tect√©e‚Ä¶ mais bon, il est trop rapide üòÖ");
    });

    // YES direct
    $("#yes").addEventListener("click", ()=>{
      launchConfetti();
      goStep3();
    });

    // Close main modal (optional)
    $("#closeBtn").addEventListener("click", ()=>{
      document.querySelector("#overlay").style.display = "none";
    });

    // --- "Pas cette fois" => YES storm sequence ---
    const storm = $("#storm");
    let stormInterval = null;

    function randomBetween(a,b){ return a + Math.random()*(b-a); }

    function spawnYesBubble(){
      const btn = document.createElement("button");
      btn.className = "yesBubble";
      btn.type = "button";
      btn.textContent = "Oui üíö";

      // random size for fun
      const scale = randomBetween(0.85, 1.15);
      btn.style.transform = `scale(${scale})`;

      // position within viewport, avoiding the header area
      const header = storm.querySelector(".stormHeader").getBoundingClientRect();
      const w = window.innerWidth;
      const h = window.innerHeight;

      const x = randomBetween(12, Math.max(12, w - 140));
      const y = randomBetween(header.bottom + 10, Math.max(header.bottom + 10, h - 70));

      btn.style.left = x + "px";
      btn.style.top  = y + "px";

      btn.addEventListener("click", ()=>{
        stopStorm();
        alert("Je savais que tu voulais rolala üòÇ");
        launchConfetti();
        goStep3();
      });

      storm.appendChild(btn);
    }

    function startStorm(){
      // lock
      $("#notNow").disabled = true;
      $("#yes").disabled = true;
      $("#no").disabled = true;

      storm.classList.add("show");
      storm.setAttribute("aria-hidden","false");

      $("#stormTitle").textContent = "Regarde l√† ! tu n'as pas le choix ma s≈ìur üòÇ";
      $("#stormSubtitle").textContent = "Tu vas tellement choisir ‚Äúoui‚Äù en briiiii üò≠ (clique sur un des ‚ÄúOui‚Äù)";

      // progressively fill the screen with YES bubbles
      let count = 0;
      stormInterval = setInterval(()=>{
        spawnYesBubble();
        count++;

        // accelerate a bit
        if(count === 10){
          // burst
          for(let i=0;i<10;i++) spawnYesBubble();
        }
        if(count >= 30){
          clearInterval(stormInterval);
          stormInterval = null;
          // keep a few more with a final burst
          for(let i=0;i<25;i++) spawnYesBubble();
        }
      }, 120);
    }

    function stopStorm(){
      if(stormInterval){ clearInterval(stormInterval); stormInterval = null; }
      // remove bubbles
      storm.querySelectorAll(".yesBubble").forEach(b=>b.remove());
      storm.classList.remove("show");
      storm.setAttribute("aria-hidden","true");

      // unlock
      $("#notNow").disabled = false;
      $("#yes").disabled = false;
      $("#no").disabled = false;
    }

    $("#notNow").addEventListener("click", startStorm);

    // Plan selection
    let selectedPlan = "";
    document.querySelectorAll("[data-plan]").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        selectedPlan = btn.getAttribute("data-plan");
        $("#planNote").style.display = "block";
        $("#planNote").textContent = "‚úÖ Choix enregistr√© : " + selectedPlan;
        document.querySelectorAll("[data-plan]").forEach(b=>b.style.outline="none");
        btn.style.outline="2px solid #ffffff55";
      });
    });

    // Send via WhatsApp (no signature)
    $("#send").addEventListener("click", ()=>{
      if(!WA_NUMBER){
        alert("Num√©ro WhatsApp non d√©fini.");
        return;
      }
      if(!selectedPlan){
        alert("Choisis Bouffe / Cin√© / Cin√© + Bouffe üôÇ");
        return;
      }
      const msg = encodeURIComponent(
        "Oui üíö\n\nOn sort vendredi soir üòÑ\n" +
        "Je choisis : " + selectedPlan
      );
      window.open("https://wa.me/" + WA_NUMBER + "?text=" + msg, "_blank");
    });

    // Confetti
    function launchConfetti(){
      confetti.innerHTML = "";
      confetti.classList.add("show");
      const count = 110;
      const colors = ["#7c5cff","#27d7c4","#ff4d6d","#ffd166","#9bff6a","#5bd7ff","#ffffff"];
      for(let i=0;i<count;i++){
        const div = document.createElement("div");
        div.className = "piece";
        div.style.left = (Math.random()*100) + "vw";
        div.style.background = colors[Math.floor(Math.random()*colors.length)];
        div.style.animationDuration = (2.2 + Math.random()*2.2) + "s";
        div.style.animationDelay = (Math.random()*0.35) + "s";
        div.style.transform = "translateY(-20px) rotate(" + (Math.random()*360) + "deg)";
        div.style.width = (7 + Math.random()*10) + "px";
        div.style.height = (10 + Math.random()*14) + "px";
        confetti.appendChild(div);
      }
      setTimeout(()=> confetti.classList.remove("show"), 2600);
    }

    // Initial placement: ensure NO not superposed with YES
    window.addEventListener("load", ()=> setTimeout(moveNoBtn, 80));
  </script>
</body>
</html>
